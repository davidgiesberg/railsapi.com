<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>PhotoCanvas</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/github.css" type="text/css" media="screen" />
<script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Class</span> 
            PhotoCanvas 
            
                <span class="parent">&lt; 
                    
                    <a href="TkScrolledCanvas.html">TkScrolledCanvas</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/ext/tk/sample/figmemo_sample_rb.html">ext/tk/sample/figmemo_sample.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>#</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-_state0">_state0</a>,
              </li>
            
              
              <li>
                <a href="#method-i-_state1">_state1</a>,
              </li>
            
              
              <li>
                <a href="#method-i-_state2">_state2</a>,
              </li>
            
              
              <li>
                <a href="#method-i-_state3">_state3</a>,
              </li>
            
              
              <li>
                <a href="#method-i-_state4">_state4</a>,
              </li>
            
              
              <li>
                <a href="#method-i-_state5">_state5</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>F</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-fig_erase">fig_erase</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>G</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-get_texts">get_texts</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>L</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-load_photo">load_photo</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>M</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-modified-3F">modified?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-reset_region">reset_region</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    
      <!-- Section constants -->
      <div class="sectiontitle">Constants</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">USAGE</td>
            <td>=</td>
            <td class="attr-value">&lt;&lt;EOT
--- WHAT IS ---
You can write comments on the loaded image, and save it as a Postscipt
file (original image file is not modified). Each comment is drawn as a
set of an indicator circle, an arrow, and a memo text. See the following
how to write comments.
This can save the list of memo texts to another file. It may useful to
search the saved Postscript file by the comments on them.
This may not support multibyte characters (multibyte texts are broken on
a Postscript file). It depends on features of canvas widgets of Tcl/Tk
libraries linked your Ruby/Tk. If you use Tcl/Tk8.0-jp (Japanized Tcl/Tk),
you can (possibly) get a Japanese Postscript file.

--- BINDINGS ---
* Button-1 : draw comments by following steps
1st - Set center of a indicator circle.
2nd - Set head position of an arrow.
3rd - Set tail position of an arrow, and show an entry box.
Input a memo text and hit &#39;Enter&#39; key to entry the comment.

* Button-2-drag : scroll the canvas

* Button-3 : when drawing, cancel current drawing

* Double-Button-3 : delete the clicked comment (text, arrow, and circle)
EOT</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
      </table>
    


    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-new">
            
              <b>new</b>(*args)
            
            <a href="../classes/PhotoCanvas.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/tk/sample/figmemo_sample.rb, line 83</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">initialize</span>(*<span class="ruby-identifier">args</span>)
  <span class="ruby-keyword">super</span>(*<span class="ruby-identifier">args</span>)

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">highlightthickness</span> = <span class="ruby-number">0</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">selectborderwidth</span> = <span class="ruby-number">0</span>

  <span class="ruby-ivar">@photo</span> = <span class="ruby-constant">TkPhotoImage</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@img</span> = <span class="ruby-constant">TkcImage</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>, <span class="ruby-number">0</span>, <span class="ruby-number">0</span>, <span class="ruby-value">:image=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@photo</span>)

  <span class="ruby-identifier">width</span>  = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">width</span>
  <span class="ruby-identifier">height</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">height</span>
  <span class="ruby-ivar">@scr_region</span> = [<span class="ruby-operator">-</span><span class="ruby-identifier">width</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">height</span>, <span class="ruby-identifier">width</span>, <span class="ruby-identifier">height</span>]
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">scrollregion</span>(<span class="ruby-ivar">@scr_region</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">xview_moveto</span>(<span class="ruby-number">0.25</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">yview_moveto</span>(<span class="ruby-number">0.25</span>)

  <span class="ruby-ivar">@col</span> = <span class="ruby-string">&#39;red&#39;</span>
  <span class="ruby-ivar">@font</span> = <span class="ruby-string">&#39;Helvetica -12&#39;</span>

  <span class="ruby-ivar">@memo_id_num</span> = <span class="ruby-number">-1</span>
  <span class="ruby-ivar">@memo_id_head</span> = <span class="ruby-string">&#39;memo_&#39;</span>
  <span class="ruby-ivar">@memo_id_tag</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@overlap_d</span> = <span class="ruby-number">2</span>

  <span class="ruby-ivar">@state</span> = <span class="ruby-constant">TkVariable</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@border</span> = <span class="ruby-number">2</span>
  <span class="ruby-ivar">@selectborder</span> = <span class="ruby-number">1</span>
  <span class="ruby-ivar">@delta</span> = <span class="ruby-ivar">@border</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@selectborder</span>
  <span class="ruby-ivar">@entry</span> = <span class="ruby-constant">TkEntry</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>, <span class="ruby-value">:relief=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">:ridge</span>, <span class="ruby-value">:borderwidth=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@border</span>,
                       <span class="ruby-value">:selectborderwidth=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@selectborder</span>,
                       <span class="ruby-value">:highlightthickness=</span><span class="ruby-operator">&gt;</span><span class="ruby-number">0</span>)
  <span class="ruby-ivar">@entry</span>.<span class="ruby-identifier">bind</span>(<span class="ruby-string">&#39;Return&#39;</span>){<span class="ruby-ivar">@state</span>.<span class="ruby-identifier">value</span> = <span class="ruby-number">0</span>}

  <span class="ruby-ivar">@mode</span> = <span class="ruby-identifier">old_mode</span> = <span class="ruby-number">0</span>

  <span class="ruby-identifier">_state0</span>()

  <span class="ruby-identifier">bind</span>(<span class="ruby-string">&#39;2&#39;</span>, <span class="ruby-value">:x</span>, <span class="ruby-value">:y</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span><span class="ruby-operator">|</span> <span class="ruby-identifier">scan_mark</span>(<span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span>)}
  <span class="ruby-identifier">bind</span>(<span class="ruby-string">&#39;B2-Motion&#39;</span>, <span class="ruby-value">:x</span>, <span class="ruby-value">:y</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span><span class="ruby-operator">|</span> <span class="ruby-identifier">scan_dragto</span>(<span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span>)}

  <span class="ruby-identifier">bind</span>(<span class="ruby-string">&#39;3&#39;</span>){
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">old_mode</span> = <span class="ruby-ivar">@mode</span>) <span class="ruby-operator">==</span> <span class="ruby-number">0</span>
    <span class="ruby-ivar">@items</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">delete</span> }
    <span class="ruby-identifier">_state0</span>()
  }

  <span class="ruby-identifier">bind</span>(<span class="ruby-string">&#39;Double-3&#39;</span>, <span class="ruby-value">:widget</span>, <span class="ruby-value">:x</span>, <span class="ruby-value">:y</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">w</span>, <span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">old_mode</span> <span class="ruby-operator">!=</span> <span class="ruby-number">0</span>
    <span class="ruby-identifier">x</span> = <span class="ruby-identifier">w</span>.<span class="ruby-identifier">canvasx</span>(<span class="ruby-identifier">x</span>)
    <span class="ruby-identifier">y</span> = <span class="ruby-identifier">w</span>.<span class="ruby-identifier">canvasy</span>(<span class="ruby-identifier">y</span>)
    <span class="ruby-identifier">tag</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">w</span>.<span class="ruby-identifier">find_overlapping</span>(<span class="ruby-identifier">x</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@overlap_d</span>, <span class="ruby-identifier">y</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@overlap_d</span>,
                       <span class="ruby-identifier">x</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@overlap_d</span>, <span class="ruby-identifier">y</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@overlap_d</span>).<span class="ruby-identifier">find</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
      <span class="ruby-operator">!</span> (<span class="ruby-identifier">item</span>.<span class="ruby-identifier">tags</span>.<span class="ruby-identifier">find</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
           <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/^(#{@memo_id_head}\d+)$/</span>
             <span class="ruby-identifier">tag</span> = <span class="ruby-node">$1</span>
           <span class="ruby-keyword">end</span>
         }.<span class="ruby-identifier">empty?</span>)
    }
    <span class="ruby-identifier">w</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">tag</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">tag</span>
  }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                  
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-fig_erase">
            
              <b>fig_erase</b>()
            
            <a href="../classes/PhotoCanvas.html#method-i-fig_erase" name="method-i-fig_erase" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-fig_erase_source')" id="l_method-i-fig_erase_source">show</a>
                
              </p>
              <div id="method-i-fig_erase_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/tk/sample/figmemo_sample.rb, line 264</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">fig_erase</span>
  (<span class="ruby-identifier">find_withtag</span>(<span class="ruby-string">&#39;all&#39;</span>) <span class="ruby-operator">-</span> [<span class="ruby-ivar">@img</span>]).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">delete</span>}
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-get_texts">
            
              <b>get_texts</b>()
            
            <a href="../classes/PhotoCanvas.html#method-i-get_texts" name="method-i-get_texts" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-get_texts_source')" id="l_method-i-get_texts_source">show</a>
                
              </p>
              <div id="method-i-get_texts_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/tk/sample/figmemo_sample.rb, line 287</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">get_texts</span>
  <span class="ruby-identifier">ret</span> = []
  <span class="ruby-identifier">find_withtag</span>(<span class="ruby-string">&#39;all&#39;</span>).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">TkcText</span>)
      <span class="ruby-identifier">ret</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">item</span>[<span class="ruby-value">:text</span>]
    <span class="ruby-keyword">end</span>
  }
  <span class="ruby-identifier">ret</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-load_photo">
            
              <b>load_photo</b>(filename)
            
            <a href="../classes/PhotoCanvas.html#method-i-load_photo" name="method-i-load_photo" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-load_photo_source')" id="l_method-i-load_photo_source">show</a>
                
              </p>
              <div id="method-i-load_photo_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/tk/sample/figmemo_sample.rb, line 256</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">load_photo</span>(<span class="ruby-identifier">filename</span>)
  <span class="ruby-ivar">@photo</span>.<span class="ruby-identifier">configure</span>(<span class="ruby-value">:file=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">filename</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-modified-3F">
            
              <b>modified?</b>()
            
            <a href="../classes/PhotoCanvas.html#method-i-modified-3F" name="method-i-modified-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-modified-3F_source')" id="l_method-i-modified-3F_source">show</a>
                
              </p>
              <div id="method-i-modified-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/tk/sample/figmemo_sample.rb, line 260</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">modified?</span>
  <span class="ruby-operator">!</span> ((<span class="ruby-identifier">find_withtag</span>(<span class="ruby-string">&#39;all&#39;</span>) <span class="ruby-operator">-</span> [<span class="ruby-ivar">@img</span>]).<span class="ruby-identifier">empty?</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-reset_region">
            
              <b>reset_region</b>()
            
            <a href="../classes/PhotoCanvas.html#method-i-reset_region" name="method-i-reset_region" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-reset_region_source')" id="l_method-i-reset_region_source">show</a>
                
              </p>
              <div id="method-i-reset_region_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/tk/sample/figmemo_sample.rb, line 268</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">reset_region</span>
  <span class="ruby-identifier">width</span> = <span class="ruby-ivar">@photo</span>.<span class="ruby-identifier">width</span>
  <span class="ruby-identifier">height</span> = <span class="ruby-ivar">@photo</span>.<span class="ruby-identifier">height</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">width</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@scr_region</span>[<span class="ruby-number">2</span>]
    <span class="ruby-ivar">@scr_region</span>[<span class="ruby-number">0</span>] = <span class="ruby-operator">-</span><span class="ruby-identifier">width</span>
    <span class="ruby-ivar">@scr_region</span>[<span class="ruby-number">2</span>] = <span class="ruby-identifier">width</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">height</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@scr_region</span>[<span class="ruby-number">3</span>]
    <span class="ruby-ivar">@scr_region</span>[<span class="ruby-number">1</span>] = <span class="ruby-operator">-</span><span class="ruby-identifier">height</span>
    <span class="ruby-ivar">@scr_region</span>[<span class="ruby-number">3</span>] = <span class="ruby-identifier">height</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">scrollregion</span>(<span class="ruby-ivar">@scr_region</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">xview_moveto</span>(<span class="ruby-number">0.25</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">yview_moveto</span>(<span class="ruby-number">0.25</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
              
      <div class="sectiontitle">Instance Private methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-_state0">
            
              <b>_state0</b>()
            
            <a href="../classes/PhotoCanvas.html#method-i-_state0" name="method-i-_state0" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-_state0_source')" id="l_method-i-_state0_source">show</a>
                
              </p>
              <div id="method-i-_state0_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/tk/sample/figmemo_sample.rb, line 148</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">_state0</span>() <span class="ruby-comment"># init</span>
  <span class="ruby-ivar">@mode</span> = <span class="ruby-number">0</span>

  <span class="ruby-ivar">@memo_id_num</span> <span class="ruby-operator">+=</span> <span class="ruby-number">1</span>
  <span class="ruby-ivar">@memo_id_tag</span> = <span class="ruby-ivar">@memo_id_head</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@memo_id_num</span>.<span class="ruby-identifier">to_s</span>

  <span class="ruby-ivar">@target</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@items</span> = []
  <span class="ruby-ivar">@mark</span> = [<span class="ruby-number">0</span>, <span class="ruby-number">0</span>]
  <span class="ruby-identifier">bind_remove</span>(<span class="ruby-string">&#39;Motion&#39;</span>)
  <span class="ruby-identifier">bind</span>(<span class="ruby-string">&#39;ButtonRelease-1&#39;</span>, <span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span><span class="ruby-operator">|</span> <span class="ruby-identifier">_state1</span>(<span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span>)}, <span class="ruby-string">&#39;%x&#39;</span>, <span class="ruby-string">&#39;%y&#39;</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-_state1">
            
              <b>_state1</b>(x,y)
            
            <a href="../classes/PhotoCanvas.html#method-i-_state1" name="method-i-_state1" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-_state1_source')" id="l_method-i-_state1_source">show</a>
                
              </p>
              <div id="method-i-_state1_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/tk/sample/figmemo_sample.rb, line 161</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">_state1</span>(<span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span>) <span class="ruby-comment"># set center</span>
  <span class="ruby-ivar">@mode</span> = <span class="ruby-number">1</span>

  <span class="ruby-ivar">@target</span> = <span class="ruby-constant">TkcOval</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>,
                        [<span class="ruby-identifier">canvasx</span>(<span class="ruby-identifier">x</span>), <span class="ruby-identifier">canvasy</span>(<span class="ruby-identifier">y</span>)], [<span class="ruby-identifier">canvasx</span>(<span class="ruby-identifier">x</span>), <span class="ruby-identifier">canvasy</span>(<span class="ruby-identifier">y</span>)],
                        <span class="ruby-value">:outline=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@col</span>, <span class="ruby-value">:width=</span><span class="ruby-operator">&gt;</span><span class="ruby-number">3</span>, <span class="ruby-value">:tags=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-ivar">@memo_id_tag</span>])
  <span class="ruby-ivar">@items</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@target</span>
  <span class="ruby-ivar">@mark</span> = [<span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span>]

  <span class="ruby-identifier">bind</span>(<span class="ruby-string">&#39;Motion&#39;</span>, <span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span><span class="ruby-operator">|</span> <span class="ruby-identifier">_state2</span>(<span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span>)}, <span class="ruby-string">&#39;%x&#39;</span>, <span class="ruby-string">&#39;%y&#39;</span>)
  <span class="ruby-identifier">bind</span>(<span class="ruby-string">&#39;ButtonRelease-1&#39;</span>, <span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span><span class="ruby-operator">|</span> <span class="ruby-identifier">_state3</span>(<span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span>)}, <span class="ruby-string">&#39;%x&#39;</span>, <span class="ruby-string">&#39;%y&#39;</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-_state2">
            
              <b>_state2</b>(x,y)
            
            <a href="../classes/PhotoCanvas.html#method-i-_state2" name="method-i-_state2" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-_state2_source')" id="l_method-i-_state2_source">show</a>
                
              </p>
              <div id="method-i-_state2_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/tk/sample/figmemo_sample.rb, line 174</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">_state2</span>(<span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span>) <span class="ruby-comment"># create circle</span>
  <span class="ruby-ivar">@mode</span> = <span class="ruby-number">2</span>

  <span class="ruby-identifier">r</span> = <span class="ruby-constant">Integer</span>(<span class="ruby-constant">Math</span>.<span class="ruby-identifier">sqrt</span>((<span class="ruby-identifier">x</span><span class="ruby-operator">-</span><span class="ruby-ivar">@mark</span>[<span class="ruby-number">0</span>])<span class="ruby-operator">**</span><span class="ruby-number">2</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">y</span><span class="ruby-operator">-</span><span class="ruby-ivar">@mark</span>[<span class="ruby-number">1</span>])<span class="ruby-operator">**</span><span class="ruby-number">2</span>))
  <span class="ruby-ivar">@target</span>.<span class="ruby-identifier">coords</span>([<span class="ruby-identifier">canvasx</span>(<span class="ruby-ivar">@mark</span>[<span class="ruby-number">0</span>] <span class="ruby-operator">-</span> <span class="ruby-identifier">r</span>), <span class="ruby-identifier">canvasy</span>(<span class="ruby-ivar">@mark</span>[<span class="ruby-number">1</span>] <span class="ruby-operator">-</span> <span class="ruby-identifier">r</span>)],
                 [<span class="ruby-identifier">canvasx</span>(<span class="ruby-ivar">@mark</span>[<span class="ruby-number">0</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">r</span>), <span class="ruby-identifier">canvasy</span>(<span class="ruby-ivar">@mark</span>[<span class="ruby-number">1</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">r</span>)])
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-_state3">
            
              <b>_state3</b>(x,y)
            
            <a href="../classes/PhotoCanvas.html#method-i-_state3" name="method-i-_state3" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-_state3_source')" id="l_method-i-_state3_source">show</a>
                
              </p>
              <div id="method-i-_state3_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/tk/sample/figmemo_sample.rb, line 182</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">_state3</span>(<span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span>) <span class="ruby-comment"># set line start</span>
  <span class="ruby-ivar">@mode</span> = <span class="ruby-number">3</span>

  <span class="ruby-ivar">@target</span> = <span class="ruby-constant">TkcLine</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>,
                        [<span class="ruby-identifier">canvasx</span>(<span class="ruby-identifier">x</span>), <span class="ruby-identifier">canvasy</span>(<span class="ruby-identifier">y</span>)], [<span class="ruby-identifier">canvasx</span>(<span class="ruby-identifier">x</span>), <span class="ruby-identifier">canvasy</span>(<span class="ruby-identifier">y</span>)],
                        <span class="ruby-value">:arrow=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">:first</span>, <span class="ruby-value">:arrowshape=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-number">10</span>, <span class="ruby-number">14</span>, <span class="ruby-number">5</span>],
                        <span class="ruby-value">:fill=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@col</span>, <span class="ruby-value">:tags=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-ivar">@memo_id_tag</span>])
  <span class="ruby-ivar">@items</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@target</span>
  <span class="ruby-ivar">@mark</span> = [<span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span>]

  <span class="ruby-identifier">bind</span>(<span class="ruby-string">&#39;Motion&#39;</span>, <span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span><span class="ruby-operator">|</span> <span class="ruby-identifier">_state4</span>(<span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span>)}, <span class="ruby-string">&#39;%x&#39;</span>, <span class="ruby-string">&#39;%y&#39;</span>)
  <span class="ruby-identifier">bind</span>(<span class="ruby-string">&#39;ButtonRelease-1&#39;</span>, <span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span><span class="ruby-operator">|</span> <span class="ruby-identifier">_state5</span>(<span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span>)}, <span class="ruby-string">&#39;%x&#39;</span>, <span class="ruby-string">&#39;%y&#39;</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-_state4">
            
              <b>_state4</b>(x,y)
            
            <a href="../classes/PhotoCanvas.html#method-i-_state4" name="method-i-_state4" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-_state4_source')" id="l_method-i-_state4_source">show</a>
                
              </p>
              <div id="method-i-_state4_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/tk/sample/figmemo_sample.rb, line 196</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">_state4</span>(<span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span>) <span class="ruby-comment"># create line</span>
  <span class="ruby-ivar">@mode</span> = <span class="ruby-number">4</span>

  <span class="ruby-ivar">@target</span>.<span class="ruby-identifier">coords</span>([<span class="ruby-identifier">canvasx</span>(<span class="ruby-ivar">@mark</span>[<span class="ruby-number">0</span>]), <span class="ruby-identifier">canvasy</span>(<span class="ruby-ivar">@mark</span>[<span class="ruby-number">1</span>])],
                 [<span class="ruby-identifier">canvasx</span>(<span class="ruby-identifier">x</span>), <span class="ruby-identifier">canvasy</span>(<span class="ruby-identifier">y</span>)])
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-_state5">
            
              <b>_state5</b>(x,y)
            
            <a href="../classes/PhotoCanvas.html#method-i-_state5" name="method-i-_state5" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-_state5_source')" id="l_method-i-_state5_source">show</a>
                
              </p>
              <div id="method-i-_state5_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ext/tk/sample/figmemo_sample.rb, line 203</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">_state5</span>(<span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span>) <span class="ruby-comment"># set text</span>
  <span class="ruby-ivar">@mode</span> = <span class="ruby-number">5</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">x</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@mark</span>[<span class="ruby-number">0</span>] <span class="ruby-operator">&gt;=</span> <span class="ruby-number">0</span>
    <span class="ruby-identifier">justify</span> = <span class="ruby-string">&#39;left&#39;</span>
    <span class="ruby-identifier">dx</span> = <span class="ruby-operator">-</span> <span class="ruby-ivar">@delta</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">y</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@mark</span>[<span class="ruby-number">1</span>] <span class="ruby-operator">&gt;=</span> <span class="ruby-number">0</span>
      <span class="ruby-identifier">anchor</span> = <span class="ruby-string">&#39;nw&#39;</span>
      <span class="ruby-identifier">dy</span> = <span class="ruby-operator">-</span> <span class="ruby-ivar">@delta</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">anchor</span> = <span class="ruby-string">&#39;sw&#39;</span>
      <span class="ruby-identifier">dy</span> = <span class="ruby-ivar">@delta</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">justify</span> = <span class="ruby-string">&#39;right&#39;</span>
    <span class="ruby-identifier">dx</span> = <span class="ruby-ivar">@delta</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">y</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@mark</span>[<span class="ruby-number">1</span>] <span class="ruby-operator">&gt;=</span> <span class="ruby-number">0</span>
      <span class="ruby-identifier">anchor</span> = <span class="ruby-string">&#39;ne&#39;</span>
      <span class="ruby-identifier">dy</span> = <span class="ruby-operator">-</span> <span class="ruby-ivar">@delta</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">anchor</span> = <span class="ruby-string">&#39;se&#39;</span>
      <span class="ruby-identifier">dy</span> = <span class="ruby-ivar">@delta</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">bind_remove</span>(<span class="ruby-string">&#39;Motion&#39;</span>)

  <span class="ruby-ivar">@entry</span>.<span class="ruby-identifier">value</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-ivar">@entry</span>.<span class="ruby-identifier">configure</span>(<span class="ruby-value">:justify=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">justify</span>, <span class="ruby-value">:font=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@font</span>, <span class="ruby-value">:foreground=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@col</span>)

  <span class="ruby-identifier">ewin</span> = <span class="ruby-constant">TkcWindow</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>, [<span class="ruby-identifier">canvasx</span>(<span class="ruby-identifier">x</span>)<span class="ruby-operator">+</span><span class="ruby-identifier">dx</span>, <span class="ruby-identifier">canvasy</span>(<span class="ruby-identifier">y</span>)<span class="ruby-operator">+</span><span class="ruby-identifier">dy</span>],
                       <span class="ruby-value">:window=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@entry</span>, <span class="ruby-value">:state=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">:normal</span>, <span class="ruby-value">:anchor=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">anchor</span>,
                       <span class="ruby-value">:tags=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-ivar">@memo_id_tag</span>])

  <span class="ruby-ivar">@entry</span>.<span class="ruby-identifier">focus</span>
  <span class="ruby-ivar">@entry</span>.<span class="ruby-identifier">grab</span>
  <span class="ruby-ivar">@state</span>.<span class="ruby-identifier">wait</span>
  <span class="ruby-ivar">@entry</span>.<span class="ruby-identifier">grab_release</span>

  <span class="ruby-identifier">ewin</span>.<span class="ruby-identifier">delete</span>

  <span class="ruby-ivar">@target</span> = <span class="ruby-constant">TkcText</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>, [<span class="ruby-identifier">canvasx</span>(<span class="ruby-identifier">x</span>), <span class="ruby-identifier">canvasy</span>(<span class="ruby-identifier">y</span>)],
                        <span class="ruby-value">:anchor=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">anchor</span>, <span class="ruby-value">:justify=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">justify</span>,
                        <span class="ruby-value">:fill=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@col</span>, <span class="ruby-value">:font=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@font</span>, <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@entry</span>.<span class="ruby-identifier">value</span>,
                        <span class="ruby-value">:tags=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-ivar">@memo_id_tag</span>])

  <span class="ruby-identifier">_state0</span>()
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                    </div>

    </div>
  </body>
</html>    